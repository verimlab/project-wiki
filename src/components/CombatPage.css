.combat-root {
  min-height: 100vh;
  background: #0b1534;
  color: #e6ebff;
  padding: 48px 24px 120px;
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.combat-header {
  max-width: 1200px;
  width: 100%;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 18px;
  border-bottom: 1px solid rgba(126, 166, 255, 0.1);
  padding-bottom: 24px;
}

.combat-header h1 { margin: 0; font-size: clamp(28px, 6vw, 40px); letter-spacing: .08em; text-transform: uppercase; }
.combat-header p { margin-top: 8px; color: #d0dcffc2; letter-spacing: .06em; }

.combat-main { max-width: 1200px; width: 100%; margin: 0 auto; }
.combat-grid { display: grid; grid-template-columns: 340px 1fr; gap: 24px; }
.combat-left { display: flex; flex-direction: column; gap: 16px; }
.combat-right { display: flex; flex-direction: column; gap: 16px; }

.combat-card {
  background: linear-gradient(160deg, rgba(18, 30, 62, 0.8), rgba(26, 40, 80, 0.7));
  border: 1px solid rgba(126, 166, 255, 0.15);
  border-radius: 16px;
  padding: 16px;
  display: flex;
  flex-direction: column;
  gap: 14px;
}
.combat-card-title { font-weight: 800; letter-spacing: .08em; text-transform: uppercase; opacity: .9; }
.summary-bar { background: #141e3abf; border: 1px solid rgba(120,160,255,.22); border-radius: 10px; padding: 10px 12px; color: #cfe0ff; }

.combat-controls { display: grid; gap: 12px; }
.combat-status { opacity: .9; }
.combat-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }

.initiative-list { list-style: none; margin: 0; padding: 0; display: flex; flex-direction: column; gap: 10px; }
.initiative-item { display: flex; flex-direction: column; gap: 8px; background: #121e3e; border: 1px solid rgba(126,166,255,.15); border-radius: 12px; padding: 12px; cursor: pointer; }
.initiative-item.is-selected { outline: 2px solid #78a0ff; }
.initiative-item.is-active { box-shadow: 0 0 0 2px #71ffb4 inset; }
.initiative-name { font-weight: 600; }
.initiative-score { opacity: .9; }
.initiative-top { display: flex; justify-content: space-between; align-items: center; gap: 12px; }

.hp-row { display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 8px; }
.hp-bar { position: relative; height: 8px; background: #0e1a3a; border: 1px solid rgba(126,166,255,.25); border-radius: 999px; overflow: hidden; }
.hp-bar__fill { position: absolute; left: 0; top: 0; bottom: 0; background: linear-gradient(90deg, #71ffb4, #54d6ff); }
/* Color states for HP bars (GM view) */
.hp-bar__fill.is-high { background: linear-gradient(90deg, #2bdc85, #1fb273); }
.hp-bar__fill.is-mid { background: linear-gradient(90deg, #ffd85b, #ffb03a); }
.hp-bar__fill.is-low { background: linear-gradient(90deg, #ff6b6b, #ff3b3b); }
.hp-bar__fill.is-mp { background: linear-gradient(90deg, #a78bfa, #8b5cf6); }
.hp-text { font-size: .85rem; opacity: .85; }

.invite-form { display: grid; grid-template-columns: 1fr auto; gap: 8px; }
.invite-form--chars select { background: #0e1a3a; color: #e6ebff; border: 1px solid rgba(126,166,255,.25); border-radius: 10px; padding: 10px 12px; }
.invite-form--chars { grid-template-columns: 1fr; }
.invite-form--chars .btn { width: fit-content; }
.invite-list { margin: 0; padding-left: 18px; }

.participant-form { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 14px; }
.participant-form label { display: grid; gap: 6px; font-size: .95rem; }
.participant-form input, .participant-form select { background: #0e1a3a; color: #e6ebff; border: 1px solid rgba(126,166,255,.25); border-radius: 10px; padding: 10px 12px; }
.checkbox-row { display: flex; align-items: center; gap: 10px; grid-column: 1 / -1; margin-top: 4px; }
/* custom switch for showHp */
.checkbox-row input[type="checkbox"] { appearance: none; -webkit-appearance: none; width: 42px; height: 24px; border-radius: 999px; border: 1px solid rgba(126,166,255,.35); background: #233158; position: relative; cursor: pointer; transition: background .15s ease, border-color .15s ease; }
.checkbox-row input[type="checkbox"]::after { content: ""; position: absolute; top: 2px; left: 3px; width: 18px; height: 18px; border-radius: 50%; background: #e6ebff; box-shadow: 0 1px 2px rgba(0,0,0,.3); transition: transform .15s ease, background .15s ease; }
.checkbox-row input[type="checkbox"]:checked { background: rgba(73,214,138,.35); border-color: rgba(73,214,138,.65); }
.checkbox-row input[type="checkbox"]:checked::after { transform: translateX(18px); background: #ffffff; }

.form-actions { grid-column: 1 / -1; display: flex; gap: 8px; }

/* GM HP controls */
.gm-hp { grid-column: 1 / -1; display: flex; flex-direction: column; gap: 8px; }
.gm-hp .hp-bar { height: 10px; }
.gm-hp { grid-column: 1 / -1; display: flex; flex-direction: column; gap: 8px; }
.gm-hp .hp-bar { height: 10px; }

/* ИЗМЕНЕНИЕ: Обновленная сетка для .gm-hp-controls */
.gm-hp-controls {
  display: grid;
  grid-template-columns: 1fr auto 1fr; /* Было: repeat(2,auto) 1fr auto repeat(2,auto); */
  align-items: center;
  gap: 8px;
}

.gm-hp-controls input { background: #0e1a3a; color: #e6ebff; border: 1px solid rgba(126,166,255,.25); border-radius: 10px; padding: 8px 10px; }
.form-actions { grid-column: 1 / -1; display: flex; gap: 8px; }
.btn { display: inline-flex; align-items: center; gap: 8px; padding: 10px 14px; border-radius: 12px; border: 1px solid rgba(120,160,255,.22); background: #141e3abf; color: #e8ecff; cursor: pointer; }
.btn:hover { background: #78a0ff33; border-color: #78a0ff75; }
.btn-primary { background: #2b3b74; border-color: #5a78d4; }
.btn-danger { background: #7a2b2b; border-color: #f07878; }
.btn-secondary { background: #233158; border-color: #4a6ac4; }

.muted { opacity: .8; }

@media (max-width: 900px) {
  .combat-grid { grid-template-columns: 1fr; }
}

/* Dice roller (GM page) */
.dice-form { display: grid; gap: 12px; }
.dice-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; }
.dice-item { display: flex; flex-direction: column; gap: 8px; padding: 10px; border: 1px solid rgba(126,166,255,.15); border-radius: 12px; background: #121e3e; }
.dice-item.is-active { border-color: rgba(121,168,255,.45); box-shadow: 0 0 0 1px rgba(121,168,255,.2); }
.dice-label { font-weight: 700; letter-spacing: .08em; text-transform: uppercase; color: #e6ebff; }
.dice-controls { display: grid; grid-template-columns: auto 1fr auto; align-items: center; gap: 8px; }
.dice-count { text-align: center; font-weight: 700; }
.dice-btn { display: grid; place-items: center; width: 34px; height: 34px; border-radius: 10px; border: 1px solid rgba(126,166,255,.25); background: #0e1a3a; color: #e6ebff; cursor: pointer; }
.dice-btn:hover { background: #1a2b5a; }
.dice-summary { display: flex; justify-content: space-between; align-items: center; color: #cfe0ff; }
.dice-error { color: #ff8a8a; font-weight: 600; }
.dice-actions { display: flex; justify-content: flex-end; }
.dice-results { display: grid; gap: 8px; }
.dice-result-group { display: grid; gap: 6px; padding: 8px; border: 1px solid rgba(126,166,255,.15); border-radius: 10px; background: rgba(18,30,62,.55); }
.dice-result-title { font-weight: 700; letter-spacing: .08em; text-transform: uppercase; }
.dice-result-rolls { display: flex; flex-wrap: wrap; gap: 6px; }
.dice-chip { padding: 6px 8px; border-radius: 8px; background: rgba(34,50,86,.7); border: 1px solid rgba(118,162,255,.24); }
.invite-item { display: flex; justify-content: space-between; align-items: center; gap: 12px; padding: 8px 10px; border: 1px solid rgba(126,166,255,.15); border-radius: 10px; background: rgba(18,30,62,.45); margin-bottom: 6px; }
.invite-name { display: inline-flex; align-items: center; gap: 8px; }
.invite-status { display: inline-flex; align-items: center; gap: 6px; padding: 6px 10px; border-radius: 999px; border: 1px solid rgba(126,166,255,.22); font-size: 12px; letter-spacing: .04em; }
.invite-status.is-pending { background: rgba(255,216,91,.14); border-color: rgba(255,216,91,.36); color: #fff3c4; }
.invite-status.is-accepted { background: rgba(73,214,138,.18); border-color: rgba(73,214,138,.45); color: #eafff4; }
.invite-status.is-declined { background: rgba(255,59,59,.16); border-color: rgba(255,59,59,.42); color: #ffe2e2; }
/* --- Стили для КД в списке ГМ --- */
.initiative-name-ac {
  display: flex;
  flex-direction: column;
  gap: 4px;
  flex: 1;
  min-width: 0;
}
.initiative-name {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.initiative-ac {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  font-size: .85rem;
  color: #cfe0ff;
}
.initiative-ac i {
  font-size: .75rem;
  color: #a0c3ff;
}
.initiative-score {
  font-size: 1.1rem;
  font-weight: 700;
  flex-shrink: 0;
}
/* --- Конец стилей КД --- */

/* --- ИСПРАВЛЕНИЕ ХИТБОКСА ТУМБЛЕРА --- */
.checkbox-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 4px;
  /* Было: grid-column: 1 / -1; */
  grid-column: span 1; /* Стало: занимает 1 колонку */
  justify-self: start; /* Стало: прижимается влево */
  width: fit-content; /* Стало: ширина по содержимому */
}
/* --- Конец исправления --- */


/* --- Стили для Состояний и Эффектов --- */
.participant-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-top: 6px;
}
.tag {
  font-size: .75rem;
  padding: 3px 6px;
  border-radius: 6px;
  font-weight: 600;
  display: inline-flex;
  align-items: center;
  gap: 4px;
}
.tag.is-condition {
  background: rgba(255, 159, 64, 0.2);
  border: 1px solid rgba(255, 159, 64, 0.4);
  color: #ffca8a;
}
.tag.is-effect {
  background: rgba(255, 87, 95, 0.2);
  border: 1px solid rgba(255, 87, 95, 0.4);
  color: #ffb8bc;
}

/* Форма ГМ для управления тегами */
.form-list-manager {
  grid-column: 1 / -1;
  display: flex;
  flex-direction: column;
  gap: 8px;
  margin-top: 6px;
}
.form-list-manager label {
  font-size: .95rem;
  font-weight: 600;
}
.tag-list {
  display: flex;
  flex-wrap: wrap;
  gap: 6px;
}
.tag-list .tag {
  font-size: .85rem;
  padding: 4px 8px;
}
.tag-list .tag button {
  display: grid;
  place-items: center;
  width: 16px;
  height: 16px;
  border: none;
  background: rgba(0,0,0,.3);
  color: #fff;
  border-radius: 50%;
  cursor: pointer;
  margin-left: 4px;
  padding: 0;
  line-height: 1;
}
.tag-list .tag button:hover {
  background: rgba(0,0,0,.6);
}

.form-add-tag {
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 8px;
}
.form-add-tag .btn {
  padding: 8px 12px; /* smaller button */
}
/* --- Конец стилей --- */